INCLUDES += libnml/posemath
POSEMATHSRCS := $(addprefix libnml/posemath/, posemath.c posemath_ext.cc gomath.c sincos.c pm_vector.c)
$(call TOOBJSDEPS, $(POSEMATHSRCS)) : EXTRAFLAGS=-fPIC
USERSRCS += $(POSEMATHSRCS) 
TARGETS += ../lib/libposemath.so ../lib/libposemath.so.0

../lib/libposemath.so.0: $(call TOOBJS,$(POSEMATHSRCS))
	$(ECHO) Creating shared library $(notdir $@)
	@mkdir -p ../lib
	@rm -f $@
	@$(CXX) $(LDFLAGS) -Wl,-soname,$(notdir $@) -shared -o $@ $^

$(patsubst ./libnml/posemath/%,../include/%,$(wildcard ./libnml/posemath/*.h)): ../include/%.h: ./libnml/posemath/%.h
	cp $^ $@
$(patsubst ./libnml/posemath/%,../include/%,$(wildcard ./libnml/posemath/*.hh)): ../include/%.hh: ./libnml/posemath/%.hh
	cp $^ $@
